<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>Calculadora de horas</title>
		
		<link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet"> 
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		
		<!-- Uso do Base64 https://stackoverflow.com/questions/9943771/adding-a-favicon-to-a-static-html-page -->
		<!-- favicon from Freepik from flaticon.com in https://www.flaticon.com/free-icon/clock_2919780?term=time&page=1&position=2 -->
		<link rel="shortcut icon" href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlz
										AAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAPESURB
										VEiJnZZLbFRVGMd/58yd6YMWCp2SSiu0YtA0YovBNQuTEkUoWIpWamKFLjQGdcPCBY+1iSY1QtDW
										krSGxMCCUhIXkvoIqz6mSI1trG1tS58gdPpiZu6cz8W8e6eV+O3u/5zz//+/79z7fVexTmzulu2W
										psrAAaUoQdjh/SsUBiYQGQXVYYXt6/212eNrcah0YH6fFCnhDHACcCWveYdCq7cbhbomtn16oDZr
										9D8F8n1yWEErkJOMZ2oockPGiM2jgBAMO3wtiJi6wWOZ7WsKFPjkI4HPAQ2Q64ITXjiYBy9mRfbc
										XgQBxuaF7hlD59+GxwkxI4pPBo96Gh0CUefXYuQH8+CzYsi3EgbOnbvF4sIDjpw/Fsf8QWj7PUzv
										jEmIiDkSy0QDbLkjxdGyaIAPt0JzSSo5wFPbNuItKUjBNnrg/T0uKkt1DNJK6bbnrixti2eQ75Nv
										FdTHnDeXrHH70RKlCwEu+ML4opkINA3WeBrU5m7Z7nIxDLhyNHSVgTfqvO1KP48DNiffrUgr0Hn1
										Lkv+AK+/txeAhSB8+kuIFRuAsK3tEm1pDhN9FU8WJMgBRISmlj6aLvc5HHdevUtHSw+eLHccy/XA
										vqfjpXK5xaqyRPMqEkEO5aWSvPP2bgC+utQDEM8kRr6/bg+VteUpZ/YWan4YiZTJGHnNQngWIEvD
										C1nO2q4Wmca1JjnAjk0KjwuCYVBK7bSAQoBCd+RiGy90sbVgA2/VlDlFvvsTFv1UHq9wkP/8zS0e
										TT2k6sxR8jIUs8sCUBQvmDjNp0bORlTuJsz0ODI1se5WkyAzFjAJ7JoJRUROffBy2kO2bWioeYbR
										shWU1o71fQ2vxI36g3GFSQvFMMKuFQO/LUN5dnpX9W+UAnB7f+m67kfmE31KRIa1wM3Y4o35dc8+
										UfROm6Qn1aHFxXUgDNA0B3P2/yf3B+GnsbiAHXbZN/Q/u9U4issASwZOjz/BhacJI9DaH07urM1D
										1dkTGkDgLLAA0DEPZ++lF7n0dRe/tnSmJf9+MIxvNu7er7T7PES754MKdU8JbxIt1cU5qB9xlmtq
										0s/90bkUzB+Ai74wP44m2jXK1P1RraZg9cDplVOi+CImvEEnBk55dmRzbOCMzgs904bOMUMgaeAA
										Hw/UeL6MAY6u7O2VQyjagNxkPCM6MjNHbB4GhJBzZPpBHx+osTqSQccXc/8l1W4JO0XRCMSLFDAw
										HIDZZQe5EUWr0u7nV5OnzSA5ttyRYmWoUnAARSkm8dsiIsNaqZshbbcPVWev2Tv+BcsTkCvM69FE
										AAAAAElFTkSuQmCC" />
		<style>
			.label {
				text-transform: uppercase;
				display: inline-flex;
				min-width: 110px;
				font-family: 'Open Sans', sans-serif;
			}
			.alinharCampos {
				display: flex;
				flex-direction: column;
				align-items: center;
			}
			.labelEcampo {
				display: table;
			}
			body {
				display: flex;
				justify-content: center;
			}
		</style>
	
   </head>
   
   <body>
      <form name="calculator" style="display: table;">
		<div class="labelEcampo">
			<div class="label"><span>Entrada</span></div>
			<input value="00:00" type="time" name="h1" id="h1" required autofocus/>
		</div>
		
		<div class="labelEcampo">
			<div class="label"><span>Saída</span></div>
			<input value="00:00" type="time" name="h2" id="h2" onfocusout="f1();" required/>
		</div>
		
		<div class="labelEcampo">
			<div class="label"><span>Entrada</span></div>
			<input value="00:00" type="time" name="h3" id="h3" onfocusout="f1();" />
		</div>
		
		<div class="labelEcampo">
			<div class="label"><span>Saída</span></div>
			<input value="00:00" type="time" name="h4" id="h4" onfocusout="f1();" />
		</div>
		
		<div class="labelEcampo">
			<div class="label"><span></span></div>
			<input value="CALCULAR" type="button" name="calcular" id="calcular" onclick="f1();" />
			<input value="RESET" type="reset" name="reset" id="reset" />
		</div>
		</br>
		
		<div class="labelEcampo">
			<div class="label"><span>Feitas</span></div>
			<input type="time" name="horasFeitas" id="horasFeitas" disabled>
		</div>
		
		<div class="labelEcampo">
			<div class="label"><span>Faltam</span></div>
			<input value="08:00" type="time" name="horasFaltando" id="horasFaltando" disabled>
		</div>
		
		<div class="labelEcampo">
			<div class="label"><span>Sair às</span></div>
			<input type="time" name="horaSair" id="horaSair" disabled>
		</div>
		
		</br>
   </form>
	  
	<!-- https://stackoverflow.com/questions/11038252/how-can-i-calculate-the-difference-between-two-times-that-are-in-24-hour-format -->
	<script>
		var PADRAO_REFERENCIA = "01/01/2007 ";
		function f1() {
			var horasFeitas = horasEntre(document.getElementById('h1').value, document.getElementById('h2').value);
			document.getElementById('horasFeitas').value = horasEntreAsString(horasFeitas);
			
			var faltando;
			if(horasFeitas.getHours() > 0 && horasFeitas.getMinutes() > 0) {
				faltando = horasEntre(horasEntreAsString(horasFeitas), "08:00");
				document.getElementById('horasFaltando').value = horasEntreAsString(faltando);
			}
			
			var campo3 = document.getElementById('h3');
			if(campo3.value != null && campo3.value.length > 0 && campo3.value != "00:00") {
				var d3 = new Date(PADRAO_REFERENCIA+campo3.value);
				
				document.getElementById('horaSair').value = somarHoras(d3,faltando);
				
				var campo4 = document.getElementById('h4');
				if(campo4 != null && campo4.value.length>0 && campo4.value != "00:00") {
					var horasFeitasFinal = somarHoras(horasFeitas,horasEntre(campo3.value,campo4.value));
					
					document.getElementById('horasFeitas').value = horasFeitasFinal;
					
					if(new Date(PADRAO_REFERENCIA+horasFeitasFinal).getHours() >= 8) {
						document.getElementById('horasFaltando').value = "00:00";
					} else {
						faltando = horasEntre(horasFeitasFinal, "08:00");
						document.getElementById('horasFaltando').value = horasEntreAsString(faltando);
					}
				}
			} else {
				document.getElementById('horaSair').value = "00:00";
			}
		};
		function horasEntre(valueCampoData1,valueCampoData2) {
			d1 = new Date(PADRAO_REFERENCIA+ valueCampoData1);
			d2 = new Date(PADRAO_REFERENCIA+ valueCampoData2);
			
			var hEntrada = d1.getHours();
			var mEntrada = d1.getMinutes();
			var hSaida = d2.getHours();
			var mSaida = d2.getMinutes();

			var hFeitas = hSaida - hEntrada;
			var mFeitos = mSaida - mEntrada;
			
			if(mFeitos < 0) {
				mFeitos += 60;
				hFeitas--;
			}
			if (mFeitos > 59) {
				mFeitos -=60;
				hFeitas++;
			}
			
			var horasFeitas = (hFeitas<10? '0'+hFeitas : hFeitas) + ':' + (mFeitos<10? '0'+mFeitos : mFeitos);
			return new Date(PADRAO_REFERENCIA+horasFeitas);
		};
		function horasEntreAsString(dataParam) {
			var hFeitas = dataParam.getHours();
			var mFeitos = dataParam.getMinutes();
			return (hFeitas<10? '0'+hFeitas : hFeitas) + ':' + (mFeitos<10? '0'+mFeitos : mFeitos);
		};
		function somarHoras(date1, date2) {
			var h1 = date1.getHours();
			var m1 = date1.getMinutes();
			
			var h2 = date2.getHours();
			var m2 = date2.getMinutes();
			
			var horasSomadas = h1 + h2;
			var minutosSomados = m1 + m2;
			
			while(minutosSomados < 0) {
				minutosSomados += 60;
				horasSomadas--;
			} 
			while(minutosSomados>59) {
				minutosSomados -= 60;
				horasSomadas++;
			}
			return (horasSomadas<10? '0'+horasSomadas : horasSomadas) + ':' + (minutosSomados<10? '0'+minutosSomados : minutosSomados);
		};
	</script>
   </body>
</html>